## 中断

过程：

发生中断时，CPU立即进入核心态。然后当前用户进程暂停，由操作系统内核对中断进行处理。不同的中断信号，会进行不同的处理。

作用：

中断可以使CPU从用户态切换到核心态，使操作系统获得计算机的控制权，从而使用特殊指令来对操作系统进行管理工作。有了中断，才能实现多道程序并发执行。

## 用户态、内核态之间是怎么切换的？

用户态到内核态是且 **只能** 是由 **中断** 实现的。

核心态到内核态是CPU通过执行一个特殊指令，将程序状态字(PSW)的标志设置为“用户态”来实现的。

## 内中断和外中断

- 内中断的信号来源是CPU内部，与当前执行的指令有关。

  有指令中断和强迫中断（硬件故障、软件中断: 整数除以0等）

- 外中断的信号来源是CPU外部，与当前执行的指令无关。

  用户强行关闭进程是外中断

  每条指令执行结束后，CPU检查是否有外部中断信号了；若有，需要保护被中断进程的CPU环境，根据中断信号类型转入相应的中 断处理程序，恢复原进程的CPU环境并退出中断，返回原进程继续往下执行。

## 系统调用

为什么要有系统调用？

为了将各种共享资源都有操作系统统一掌管，防止用户非法操作，以保证系统的稳定性和安全性。

在用户进程中，凡是与资源有关的操作（如存储分配、IO操作、文件管理等），都必须通过系统调用的方式向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。

过程：

执行movl指令将系统调用的参数放到某个 **通用寄存器** 中。

执行int x指令（陷入指令，唯一一个只能在用户态执行的指令），执行完之后会立即引发一个 **内中断** 

然后CPU立即进入核心态，执行系统调用相应的程序

最后返回用户程序。





